<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name=Generator content="Microsoft Word 15 (filtered) Частная коллекция многолетних растений для средней полосы,  растения почтой, растения для сада, коллекция декоративных растений, декоративные растения, сад природного облика,  редкие растения, коллекционные растения, растения для тенистых мест, неприхотливые растения, почвопокровные растения, лианы, декоративно-лиственные растения, лекарственные растения, папоротники, злаки, реализация декоративных растений, оптовая реализация декоративных растений, цветущие кустарники, цветущие растения, цветы купить, продажа растений, цветы для сада, посадочный материал, коллекционные растения, растения у коллекционеров, коллекция флоксов, коллекция пионов, коллекция лилейников, коллекция хост, коллекционные хосты">
	<title>Ассортимент на 2025 год - Коллекция декоративных культур</title>

    <script type="text/javascript" src="/js/prototype.js"></script>
    <script type="text/javascript" src="/js/scriptaculous.js?load=effects,builder"></script>
    <script type="text/javascript" src="/js/lightbox.js"></script>
    <script type="text/javascript">
			function toggleBlock(elementId) {
				var el = document.getElementById(elementId);
				//el.style.display = (el.style.display == 'none') ? '' : 'none';
				el.style.display = (el.style.display == 'none') ? 'block' : 'none';
			}
		</script>

    <link rel="stylesheet" href="/css/style.css" type="text/css"/>
	<link rel="stylesheet" href="/css/lightbox.css" type="text/css" media="screen" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #000;
            text-align: center;
            padding: 1px;
        }
        th {
            background-color: #99FF99;
        }
        .empty-cart {
            text-align: center;
            font-size: 18px;
            margin-top: 20px;
        }
        .remove-item {
            background-color: #FF9999;
            border: 1px solid #000;
            padding: 5px 10px;
            cursor: pointer;
        }
        .remove-item:hover {
            background-color: #FF6666;
        }
        .quantity {
            width: 50px;
            text-align: center;
        }
        .add-to-cart {
            background-color: #99FF99;
            border: 1px solid #000;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 14px;
        }
        .add-to-cart:hover {
            background-color: #77DD77;
        }
        .quantity-input {
            width: 40px;
            text-align: center;
        }
        .added {
            font-size: 16px;
            color: green;
        }
		.checkout-button {
		    background-color: #FFD700;
		    border: 1px solid #000;
		    padding: 10px 20px;
		    cursor: pointer;
		    font-size: 16px;
		    margin-top: 20px;
		}
		.checkout-button:hover {
		    background-color: #FFC107;
		}
    </style>

    <!-- Стили вложенного google sheet: -->
    <style>
        .waffle a { color: inherit; }
        .waffle .s2{text-align:center;color:#000000;font-family:Arial;font-size:10pt;vertical-align:middle;white-space:nowrap;direction:ltr;padding:0;}
        .waffle .s0{background-color:#99ff99;text-align:center;font-weight:bold;color:#000000;font-family:Arial;font-size:10pt;vertical-align:middle;white-space:nowrap;direction:ltr;padding:2px 3px 2px 3px;}
        .waffle .s3{text-align:center;font-weight:bold;color:#000000;font-family:Arial;font-size:10pt;vertical-align:middle;white-space:nowrap;direction:ltr;padding:2px 3px 2px 3px;}
        .waffle .s1{background-color:#99ff99;text-align:center;font-weight:bold;color:#000000;font-family:Arial;font-size:10pt;vertical-align:middle;white-space:normal;overflow:hidden;word-wrap:break-word;direction:ltr;padding:2px 3px 2px 3px;}
        .waffle .s6{text-align:center;color:#000000;font-family:Arial;font-size:10pt;vertical-align:middle;white-space:nowrap;direction:ltr;padding:2px 3px 2px 3px;}
        .waffle .s5{text-align:left;color:#000000;font-family:Arial;font-size:10pt;vertical-align:middle;white-space:normal;overflow:hidden;word-wrap:break-word;direction:ltr;padding:2px 3px 2px 3px;}
        .waffle .s4{text-align:left;font-weight:bold;color:#000000;font-family:Arial;font-size:10pt;vertical-align:middle;white-space:normal;overflow:hidden;word-wrap:break-word;direction:ltr;padding:2px 3px 2px 3px;}
    </style>

</head>
<body bgcolor="#CCFFCC" link="#c71585" vlink="#2f4f4f">
<table border="0" width="100%">
    <tr> <!-- начало 1й строки -->
        <td width="250px"> <!-- начало 1й ячейки -->
            <p> <img src="/Emblema.jpg" border="0" hspace="0" vspace="0"> </p>
        </td> <!-- конец 1й ячейки -->
        <td style="font-size: 40px; font-family: cursive" style="padding-left: 10px"> <!-- начало 2й ячейки -->
            <span class="green">КО</span>ллекция<br/>
            <span class="green">ДЕ</span>коративных<br/>
            <span class="green">КУ</span>льту<span class="green">Р</span>

        </td> <!-- конец 2й ячейки -->
    </tr> <!-- конец 1й строки -->

    <tr>

        <td valign="top">


            <ul id="nav" style="width: 250px">
						<li><a href="/index.html">Главная</a></li>
						<li><a href="/KODEKUR_Price.html"target="_blank">Ассортимент на 2025 год</a></li>
						<li><a href="/opt.html"target="_blank">Для оптовиков</a></li>
						<li><a href="javascript: toggleBlock('menuCatalog')">Каталог</a></li>
						<span id="menuCatalog">
							<li><a href="/arbustum.html">Декоративные кустарники</a></li>
							<li><a href="/herbs.html">Декоративные травы</a></li>
							<li><a href="/mnogoletnije.html">Многолетние культуры</a></li>
							<li><a href="/conifer.html">Хвойные</a></li>
						</span>
						<li><a href="/contacts.html">Контакты</a></li>
						
						
					</ul>

            <br/>

            <div style="width: 250px">
                <script>
                          (function() {
                            var cx = '012816619450786521312:3jqswgt6k4s';
                            var gcse = document.createElement('script');
                            gcse.type = 'text/javascript';
                            gcse.async = true;
                            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                                '//www.google.com/cse/cse.js?cx=' + cx;
                            var s = document.getElementsByTagName('script')[0];
                            s.parentNode.insertBefore(gcse, s);
                          })();
                        </script>
                <gcse:searchbox-only resultsUrl="/search.html"></gcse:searchbox-only>
            </div>

            <br>

            <p style="font-size: 35px; font-family: cursive; text-align: center">
                Собственное производство
            </p>

        </td>
        <td style="text-align: center; padding-left: 10px"> <!-- Изменяемая ячейка -->

<div class="WordSection1">
<div class=WordSection1>

<p class=MsoNormal align=right style='text-align:right;text-autospace:none'><b><span
style='font-size:16.0pt;color:black'>Дата обновления</span></b></p>

<p class=MsoNormal align=right style='text-align:right;text-autospace:none'><b><span
style='font-size:16.0pt;color:black'>01 декабря 2024 г.</span></b></p>

<p class=MsoNormal align=right style='text-align:right;text-autospace:none'><b><span
style='font-size:16.0pt;color:black'>&nbsp;</span></b></p>

<p class=MsoNormal align=center style='text-align:center;text-autospace:none'><b><span
style='font-size:16.0pt;color:black'>АССОРТИМЕНТ</span></b></p>

<p class=MsoNormal align=center style='text-align:center;text-autospace:none'><b><span
style='font-size:16.0pt;color:black'>на 2025 год</span></b></p>

<p class=MsoNormal align=center style='text-align:center;text-autospace:none'><span
style='font-size:14.0pt;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-right:16.65pt;text-align:justify;text-indent:
36.0pt;text-autospace:none'><b><span style='font-size:14.0pt;color:red'>Реализация</span></b><span
style='font-size:14.0pt;color:black'> посадочного материала производится ...... </span>





<p class=MsoNormal style='margin-right:16.65pt;text-align:justify;text-indent:
36.0pt;text-autospace:none'><b><span style='font-size:14.0pt'>С фотографиями
растений, а также с их описанием можно ознакомиться на сайте </span></b><a
href="http://kodekur.ru"><span style='font-size:14.0pt'>http://kodekur.ru</span></a><span
class=MsoHyperlink><span style='font-size:14.0pt'>.</span></span></p>

  
    <span><b>КОРЗИНА: </b></span><button class="add-to-cart toggle-button" onclick="toggleCart()">Развернуть корзину</button>
    <div class="cart-container" id="cart-container" style="display: none">
        <table id="cart-table">
            <thead>
                <tr>
                    <th>Фото</th>
                    <th>Код</th>
                    <th>Наименование</th>
                    <th>Цена, руб.</th>
                    <th>Количество</th>
                    <th>Действие</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <p class="empty-cart" id="empty-message">Ваша корзина пуста.</p>
    </div>
	<button id="checkout-button" class="checkout-button" onclick="window.location.href='korzina.html'" disabled>
	    Оформить заказ
	</button>

    <h2>Каталог растений</h2>
	<div id="product-catalog"></div>

    <script>
        const SHEET_ID = '1297754209';
        const SHEET_HTML_URL = 'https://docs.google.com/spreadsheets/u/0/d/e/2PACX-1vQb5BPZlW4dBNxs_dlAa1myvkuMSCB6NY23yR6BlAvNPY3J0Z3Oy7zh0Ngqo8cLGfcJveCgYo6OzVdk/pubhtml/sheet?headers=false&gid=' + SHEET_ID;

const PROXY = 'https://script.google.com/macros/s/AKfycbyjdFe7Cb0IrdXxADFDJb1FgPZvoUgsag1sOwQG6TPxjcNy0BAiuqJZ7zlCczHphAAq/exec?url=';

function cleanImageUrl(url) {
  // удаляем =w###-h###, но сохраняем всё после (например, ?key=...)
  return url.replace(/=w\d+-h\d+/i, '');
}

function jsonp(url){
  return new Promise((resolve, reject)=>{
    const cb = 'cb_' + Math.random().toString(36).slice(2);
    const s = document.createElement('script');
    window[cb] = (data)=>{ resolve(data); delete window[cb]; s.remove(); };
    s.onerror = reject;
    s.src = url + '&callback=' + cb;
    document.head.appendChild(s);
  });
}

// после вставки таблицы:
/* TOOD: remove?
async function replaceImagesWithProxy(container){
  const imgs = Array.from(container.querySelectorAll('img'));
  const batch = 3; const sleep = ms => new Promise(r=>setTimeout(r,ms));
  for (let i=0;i<imgs.length;i+=batch){
    await Promise.all(imgs.slice(i,i+batch).map(async (img)=>{
      const src = img.getAttribute('data-src') || img.src; // исходный lh3
      img.removeAttribute('src'); img.loading='lazy';
      try{
        origSizeImg = cleanImageUrl(src);
        const j = await jsonp(PROXY + encodeURIComponent(origSizeImg));
        if (j && j.dataUrl) img.src = j.dataUrl;
      } catch(_){
        img.alt='load error'; img.style.outline='2px solid red';
      }
    }));
    await sleep(150);
  }
}
*/

function loadCatalog() {
  fetch(SHEET_HTML_URL, { cache: 'no-store' })
    .then(r => r.text())
    .then(data => {
      console.log('Fetched catalog data:\n', data);

      const container = document.getElementById('product-catalog');
      const match = data.match(/<table[\s\S]*?<\/table>/i);
      if (!match) throw new Error('Таблица не найдена');
      container.innerHTML = match[0];
    
      //replaceImagesWithProxy(container);

      addBuyButtons();
    })
    .catch(e => {
      console.error(e);
      document.getElementById('product-catalog').textContent = 'Ошибка загрузки каталога.';
    });
}



		function addBuyButtons() {
		    const rows = document.querySelectorAll('#product-catalog table tr');
		    rows.forEach((row, index) => {
		        const cells = row.querySelectorAll('td');

                if (cells.length === 0) return; // TODO WTF? пропускаем

		        // Обрабатываем строки с colspan
		        const firstCell = cells[0];

                 // для заголовков разделов - меняем colspan=4 на colspan=5 (или 5 на 6)
		        if (firstCell.hasAttribute('colspan') && firstCell.getAttribute('colspan') === '5') {
		            firstCell.setAttribute('colspan', '6');
		            return;
		        }

		        // Добавляем текст "Купить" в заголовке, если во второй колонке "Код"
		        // if (index === 0 && cells[1]?.textContent.trim().toLowerCase() === 'код') {
		        if (index === 1) {
                    //console.log('Adding "Купить" header into row:', row);
		            const buyHeaderCell = document.createElement('th'); // TODO: th OR td? Gsheet uses td for header row 🤨
		            buyHeaderCell.textContent = 'Купить';
		            row.appendChild(buyHeaderCell);
		            return;
		        }

		        // Проверяем, содержит ли вторая колонка числовой код и пятая колонка цену (или слово НЕТ)
		        const codeCell = cells[1];
		        const priceCell = cells[4];
		        const buyCell = document.createElement('td'); // Создаем ячейку для кнопки или пустоты

		        const isCodeValid = codeCell && /^[0-9]+$/.test(codeCell.textContent.trim());
		        const isPriceValid = priceCell && /\d+/.test(priceCell.textContent.trim());

		        if (isCodeValid && isPriceValid) {
		            const quantityInput = document.createElement('input');
		            quantityInput.type = 'number';
		            quantityInput.value = '1';
		            quantityInput.min = '1';
		            quantityInput.className = 'quantity-input';

		            const buyButton = document.createElement('button');
		            buyButton.textContent = 'Добавить';
		            buyButton.className = 'add-to-cart';
		            buyButton.onclick = function () {
		                // Заменяем содержимое ячейки на текст "✅ Добавлено"
		                buyCell.innerHTML = '<span class="added">✅ Добавлено</span>';
		                addToCartFromRow(row, quantityInput.value);
		            };

		            buyCell.appendChild(quantityInput);
		            buyCell.appendChild(buyButton);
		        }

		        row.appendChild(buyCell); // Добавляем ячейку в любом случае
		    });
		}

		function addToCartFromRow(row, quantity) {
		    const cells = row.querySelectorAll('td');
		    const photo = cells[0].innerHTML;
		    const code = cells[1].textContent;
		    const name = cells[2].textContent;
		    const price = cells[4].textContent;

		    const cart = JSON.parse(localStorage.getItem('cart')) || {};

		    if (cart[code]) {
		        cart[code].quantity += parseInt(quantity);
		    } else {
		        cart[code] = { photo, name, price, quantity: parseInt(quantity) };
		    }

		    localStorage.setItem('cart', JSON.stringify(cart));
		    // alert(`Товар ${name} добавлен в корзину`);
			loadCart();
		}

        function loadCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || {};
            const cartTableBody = document.querySelector('#cart-table tbody');
            const emptyMessage = document.getElementById('empty-message');
		    const checkoutButton = document.getElementById('checkout-button');

            // Clear the cart display
            cartTableBody.innerHTML = '';

            if (Object.keys(cart).length === 0) {
                emptyMessage.style.display = 'block';
		        checkoutButton.disabled = true; // Отключаем кнопку "Оформить заказ"
                return;
            }

            emptyMessage.style.display = 'none';
		    checkoutButton.disabled = false; // Активируем кнопку "Оформить заказ"

            Object.entries(cart).forEach(([code, item]) => {
                const row = document.createElement('tr');

                const photoCell = document.createElement('td');
                photoCell.innerHTML = item.photo;
                row.appendChild(photoCell);

                const codeCell = document.createElement('td');
                codeCell.textContent = code;
                row.appendChild(codeCell);

                const nameCell = document.createElement('td');
                nameCell.textContent = item.name;
                row.appendChild(nameCell);

                const priceCell = document.createElement('td');
                priceCell.textContent = item.price;
                row.appendChild(priceCell);

                const quantityCell = document.createElement('td');
                const quantityInput = document.createElement('input');
                quantityInput.type = 'number';
                quantityInput.value = item.quantity;
                quantityInput.min = '1';
                quantityInput.className = 'quantity';
                quantityInput.addEventListener('change', () => updateQuantity(code, quantityInput.value));
                quantityCell.appendChild(quantityInput);
                row.appendChild(quantityCell);

                const actionCell = document.createElement('td');
                const removeButton = document.createElement('button');
                removeButton.textContent = 'Удалить';
                removeButton.className = 'remove-item';
                removeButton.addEventListener('click', () => removeItem(code));
                actionCell.appendChild(removeButton);
                row.appendChild(actionCell);

                cartTableBody.appendChild(row);
            });
        }

        function updateQuantity(code, newQuantity) {
            const cart = JSON.parse(localStorage.getItem('cart')) || {};
            cart[code].quantity = parseInt(newQuantity);
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        function removeItem(code) {
            const cart = JSON.parse(localStorage.getItem('cart')) || {};
            delete cart[code];
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
        }
		
        function toggleCart() {
            const cartContainer = document.getElementById('cart-container');
            const toggleButton = document.querySelector('.toggle-button');

            if (cartContainer.style.display === 'none' || cartContainer.style.display === '') {
                cartContainer.style.display = 'block';
                toggleButton.textContent = 'Свернуть корзину';
            } else {
                cartContainer.style.display = 'none';
                toggleButton.textContent = 'Развернуть корзину';
            }
        }

		window.onload = function () {
		    loadCart();
		    loadCatalog();
		};
    </script>
</td>
</tr>
</table>
</body>
</html>
